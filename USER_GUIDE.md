# E2M Sonar Debug Tool - 사용자 가이드

## 목차
1. [시작하기](#시작하기)
2. [시뮬레이터 모드](#시뮬레이터-모드)
3. [실제 하드웨어 연결](#실제-하드웨어-연결)
4. [화면 구성](#화면-구성)
5. [어군 감지](#어군-감지)
6. [데이터 내보내기](#데이터-내보내기)
7. [테마 설정](#테마-설정)
8. [문제 해결](#문제-해결)

## 시작하기

### 앱 실행
1. `sonar_debug_tool.exe` 실행 (Windows)
2. 또는 `flutter run` 명령으로 개발 모드 실행

### 첫 화면
앱을 실행하면 홈 화면이 표시됩니다:
- 상단: 연결 바 (연결 상태, 연결/해제 버튼)
- 좌측: 상태 대시보드, GPS 정보, 통계
- 중앙: Sonar 그래프
- 우측: 제어 패널
- 하단: 패킷 로그

## 시뮬레이터 모드

### 시뮬레이터란?
하드웨어 없이 앱을 테스트할 수 있는 기능입니다. 실제 소나 장비와 동일한 데이터를 생성합니다.

### 시뮬레이터 활성화
1. 우상단 **설정 아이콘** 클릭
2. "연결 설정" 섹션에서 **"시뮬레이터 사용"** 스위치 ON
3. 하단 **"저장"** 버튼 클릭
4. 뒤로가기로 홈 화면으로 이동

### 시뮬레이터 사용하기
1. 연결 바에서 **"연결"** 버튼 클릭
2. 제어 패널에서 **"물속 진입"** 버튼 클릭
3. 자동으로 데이터 생성 시작
4. Sonar 그래프에서 실시간 데이터 확인

### 시뮬레이터 기능
- **물속 진입/이탈**: 데이터 수집 시작/종료
- **주파수 변경**: 83kHz, 200kHz, 455kHz
- **어군 패턴**: 랜덤 어군 클러스터 생성
- **GPS 시뮬레이션**: 이동하는 GPS 좌표
- **수온 변화**: 12°C ~ 20°C 범위

## 실제 하드웨어 연결

### 하드웨어 설정
1. 소나 장비를 WiFi AP 모드로 설정
2. 컴퓨터를 소나 WiFi에 연결
3. 기본 IP: 192.168.4.1, 포트: 36001

### 앱 설정
1. 설정 화면 열기
2. **"시뮬레이터 사용"** OFF
3. IP 주소 입력 (예: 192.168.4.1)
4. 포트 입력 (예: 36001)
5. **"자동 재연결"** ON (권장)
6. **"저장"** 버튼 클릭

### 연결하기
1. 홈 화면에서 **"연결"** 버튼 클릭
2. 연결 바가 녹색으로 변경되면 성공
3. 자동으로 데이터 수신 시작

## 화면 구성

### 연결 바 (상단)
- **상태 표시**: 연결됨(녹색) / 연결 해제(빨강)
- **IP 주소**: 현재 연결 대상
- **연결/해제 버튼**: 수동 연결 제어

### 상태 대시보드 (좌측 상단)
- **물 상태**: 물 밖 / 물속
- **수온**: 현재 수온 (°C)
- **스캔 깊이**: 현재 스캔 범위 (m)
- **주파수**: 현재 주파수 (kHz)
- **배터리**: 배터리 잔량 (%)

### GPS 표시 (좌측 중간)
- **위도/경도**: GPS 좌표
- **속도**: 이동 속도 (knots)
- **방향**: 이동 방향 (°)

### 통계 대시보드 (좌측 하단)
- **총 데이터 포인트**: 수집된 데이터 개수
- **물속 시간**: 물속 데이터 개수
- **수온 통계**: 평균/최저/최고
- **깊이 통계**: 평균/최소/최대

### Sonar 그래프 (중앙)
- **가로축**: 시간 (최근 100개)
- **세로축**: 깊이 (0m ~ 스캔 깊이)
- **색상 코드**:
  - 파랑: 물 표면
  - 노랑: 약한 신호 (어군 가능성)
  - 주황: 강한 신호 (어군 확실)
  - 빨강: 바닥

### 제어 패널 (우측)
- **연결/해제**: 수동 연결 제어
- **물속 진입/이탈**: 시뮬레이터 모드
- **주파수 변경**: 83/200/455 kHz
- **데이터 지우기**: 히스토리 삭제

### 패킷 로거 (하단)
- **타임스탬프**: 패킷 수신 시각
- **패킷 정보**: 상세 데이터
- **자동 스크롤**: 최신 로그 표시

## 어군 감지

### 자동 감지 기능
앱은 자동으로 어군을 감지하고 알림을 표시합니다.

### 감지 조건
- 신호 강도: 최소 0x05
- 클러스터 크기: 최소 3개 샘플
- 신뢰도: 60% 이상
- 바닥 신호 제외

### 어군 알림
우상단에 알림 카드 표시:
```
🐟 어군 감지!
깊이: 5.2m
강도: 강함
신뢰도: 85%
```

### 알림 제어
알림 카드 우상단 X 버튼으로 닫기

### 감지 정확도
- **높음 (80% 이상)**: 확실한 어군
- **중간 (50-80%)**: 어군 가능성
- **낮음 (50% 미만)**: 노이즈 가능성

## 데이터 내보내기

### 내보내기 메뉴
우상단 **다운로드 아이콘** 클릭

### 파일 형식

#### CSV (엑셀용)
- 타임스탬프, 물 상태, 수온, 깊이, 주파수, 배터리, GPS
- Excel, Google Sheets에서 열기 가능
- 데이터 분석에 적합

#### JSON (프로그래밍용)
- 구조화된 데이터 형식
- 프로그래밍 언어에서 파싱 가능
- API 통합에 적합

#### Markdown (리포트용)
- 세션 리포트 형식
- 통계 자동 계산 포함
- GitHub, Notion 등에서 보기 가능

### 저장 위치
- Windows: `Documents/sonar_debug_tool/`
- macOS: `Documents/sonar_debug_tool/`
- 파일명: `sonar_data_YYYYMMDD_HHMMSS.csv`

## 테마 설정

### 테마 모드
1. 설정 화면 열기
2. "테마 설정" 섹션
3. 원하는 모드 선택:
   - **시스템**: OS 설정 따름
   - **라이트 모드**: 밝은 테마
   - **다크 모드**: 어두운 테마
4. "저장" 버튼 클릭

### 테마별 색상
- **라이트**: 밝은 배경, 파란색 강조
- **다크**: 어두운 배경, 선명한 색상

### 권장 사용
- **낮 시간**: 라이트 모드
- **밤 시간**: 다크 모드
- **자동**: 시스템 모드

## 문제 해결

### 연결 안 됨
1. IP 주소 확인 (ping 테스트)
2. WiFi 연결 확인
3. 방화벽 설정 확인
4. 포트 36001 열려있는지 확인

### 데이터 수신 안 됨
1. 소나 장비가 물속에 있는지 확인
2. 제어 패널에서 "물속 진입" 클릭
3. 연결 상태 확인 (녹색)
4. 패킷 로거에서 패킷 수신 확인

### 그래프 표시 안 됨
1. 데이터 수신 중인지 확인
2. 상태 대시보드에서 "물속" 확인
3. "데이터 지우기" 후 재시작

### 어군 감지 안 됨
1. 실제 어군이 있는지 확인
2. 시뮬레이터 모드로 테스트
3. 신호 강도가 충분한지 확인
4. 바닥과 너무 가까우면 감지 안 됨

### 시뮬레이터 작동 안 됨
1. 설정에서 "시뮬레이터 사용" ON
2. "저장" 버튼 클릭 확인
3. 연결 후 "물속 진입" 클릭
4. 앱 재시작

### 설정 저장 안 됨
1. "저장" 버튼 클릭 확인
2. 녹색 스낵바 표시 확인
3. 앱 재시작 후 설정 확인

### GPS 데이터 없음
1. 소나 장비 GPS 수신 확인
2. 실외에서 테스트
3. GPS 안테나 연결 확인
4. 시뮬레이터 모드로 테스트

## 고급 사용법

### 데이터 분석
1. CSV로 내보내기
2. Excel에서 열기
3. 피벗 테이블로 분석
4. 차트 생성

### 주파수 선택
- **83kHz**: 넓은 탐지 범위, 깊은 수심
- **200kHz**: 균형잡힌 성능
- **455kHz**: 상세한 해상도, 얕은 수심

### 로그 관리
1. 설정에서 "파일 로깅" ON
2. 모든 패킷 자동 저장
3. 나중에 분석 가능
4. 디버깅에 유용

### 성능 최적화
- 데이터 히스토리 200개로 제한됨
- 주기적으로 "데이터 지우기"
- 불필요한 로깅 OFF

## 팁 & 트릭

### 효율적인 사용
1. 시뮬레이터로 먼저 익숙해지기
2. 자동 재연결 항상 ON
3. 정기적으로 데이터 내보내기
4. 통계 대시보드로 트렌드 파악

### 어군 찾기
1. 어군 알림 활성화
2. 노란색/주황색 신호 주목
3. 바닥 신호(빨강)와 구분
4. 여러 주파수 테스트

### 데이터 품질
1. 안정적인 WiFi 연결 유지
2. 배터리 충분한지 확인
3. GPS 수신 좋은 곳에서 사용
4. 물의 탁도 고려

## 키보드 단축키

현재 지원하지 않음 (향후 추가 예정)

## 지원

### 문제 보고
- GitHub Issues: [링크]
- 이메일: support@e2m.com

### 업데이트
- 자동 업데이트: 미지원
- 수동 다운로드: [링크]
- 버전 확인: 설정 > 앱 정보

---

**버전**: 2.0.0
**작성일**: 2024-01-15
**최종 수정**: 2024-01-15
